<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full-Stack CRUD Walkthrough - Week 14 Example</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a2e;
            color: #e0e0e0;
        }
        h1, h2, h3 { color: #607d8b; }
        h4 { color: #90a4ae; }
        pre {
            background: #0d1117;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            border-left: 4px solid #607d8b;
        }
        code {
            font-family: 'Consolas', 'Monaco', monospace;
            color: #e0e0e0;
        }
        .inline-code {
            background: rgba(96,125,139,0.2);
            padding: 2px 6px;
            border-radius: 4px;
            color: #90a4ae;
        }
        a { color: #90a4ae; }
        .file-section {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
        }
        .file-header {
            background: rgba(96,125,139,0.2);
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.1rem;
        }
        .step-number {
            display: inline-block;
            width: 35px;
            height: 35px;
            background: #607d8b;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: bold;
            margin-right: 10px;
        }
        .architecture {
            display: grid;
            grid-template-columns: 1fr auto 1fr auto 1fr;
            align-items: center;
            gap: 15px;
            text-align: center;
            margin: 30px 0;
        }
        .arch-box {
            background: rgba(96,125,139,0.2);
            border: 2px solid #607d8b;
            border-radius: 10px;
            padding: 20px;
        }
        .arch-arrow {
            font-size: 2rem;
            color: #607d8b;
        }
        .note {
            background: rgba(96,125,139,0.1);
            border: 1px solid rgba(96,125,139,0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <p><a href="index.html">&larr; Back to Examples</a></p>

    <h1>Full-Stack CRUD Application Walkthrough</h1>
    <p>Complete code for a Student Management System with Express backend, MySQL database, and vanilla JavaScript frontend.</p>

    <h2>Architecture Overview</h2>
    <div class="architecture">
        <div class="arch-box">
            <h3>Frontend</h3>
            <p>HTML + Bootstrap + JS</p>
            <small>Port 5500 (Live Server)</small>
        </div>
        <div class="arch-arrow">&harr;<br><small>HTTP/JSON</small></div>
        <div class="arch-box">
            <h3>Backend</h3>
            <p>Node.js + Express</p>
            <small>Port 3000</small>
        </div>
        <div class="arch-arrow">&harr;<br><small>SQL</small></div>
        <div class="arch-box">
            <h3>Database</h3>
            <p>MySQL</p>
            <small>Port 3306</small>
        </div>
    </div>

    <h2>Project Structure</h2>
    <pre><code>student-manager/
  |-- backend/
  |     |-- server.js          # Express server + routes
  |     |-- package.json       # Dependencies
  |     |-- .env               # Environment variables
  |-- frontend/
  |     |-- index.html         # UI with Bootstrap
  |     |-- app.js             # Frontend API calls
  |-- setup.sql                # Database setup script</code></pre>

    <!-- Step 1: Database Setup -->
    <div class="file-section">
        <div class="file-header">
            <span class="step-number">1</span> setup.sql - Database Setup
        </div>
        <pre><code>-- Run this in MySQL Workbench or command line
CREATE DATABASE IF NOT EXISTS student_manager;
USE student_manager;

CREATE TABLE IF NOT EXISTS students (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(150) UNIQUE NOT NULL,
    age INT CHECK (age > 0 AND age < 150),
    course VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Sample data
INSERT INTO students (name, email, age, course) VALUES
    ('Alice Johnson', 'alice@university.com', 20, 'Computer Science'),
    ('Bob Smith', 'bob@university.com', 22, 'Information Technology'),
    ('Charlie Brown', 'charlie@university.com', 21, 'Electronics'),
    ('Diana Prince', 'diana@university.com', 19, 'Computer Science'),
    ('Edward Norton', 'edward@university.com', 23, 'Mathematics');</code></pre>
    </div>

    <!-- Step 2: Backend -->
    <div class="file-section">
        <div class="file-header">
            <span class="step-number">2</span> backend/package.json
        </div>
        <pre><code>{
    "name": "student-manager-backend",
    "version": "1.0.0",
    "scripts": {
        "start": "node server.js",
        "dev": "nodemon server.js"
    },
    "dependencies": {
        "express": "^4.18.2",
        "mysql2": "^3.6.0",
        "cors": "^2.8.5",
        "dotenv": "^16.3.1"
    }
}</code></pre>
        <p>Run: <span class="inline-code">cd backend && npm install</span></p>
    </div>

    <div class="file-section">
        <div class="file-header">
            <span class="step-number">3</span> backend/.env
        </div>
        <pre><code>DB_HOST=localhost
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=student_manager
PORT=3000</code></pre>
    </div>

    <div class="file-section">
        <div class="file-header">
            <span class="step-number">4</span> backend/server.js - Complete Backend
        </div>
        <pre><code>// server.js - Complete Express backend
require('dotenv').config();
const express = require('express');
const cors = require('cors');
const mysql = require('mysql2/promise');

const app = express();
const PORT = process.env.PORT || 3000;

// Middleware
app.use(cors());
app.use(express.json());

// Database connection pool
const pool = mysql.createPool({
    host: process.env.DB_HOST,
    user: process.env.DB_USER,
    password: process.env.DB_PASSWORD,
    database: process.env.DB_NAME,
    waitForConnections: true,
    connectionLimit: 10
});

// Test database connection
pool.getConnection()
    .then(conn => { console.log('Database connected'); conn.release(); })
    .catch(err => { console.error('DB Error:', err.message); process.exit(1); });

// ============================
// ROUTES
// ============================

// GET /api/students - List all students
app.get('/api/students', async (req, res) => {
    try {
        let query = 'SELECT * FROM students';
        const params = [];

        // Search functionality
        if (req.query.search) {
            query += ' WHERE name LIKE ? OR email LIKE ? OR course LIKE ?';
            const term = `%${req.query.search}%`;
            params.push(term, term, term);
        }

        query += ' ORDER BY id DESC';
        const [rows] = await pool.execute(query, params);

        res.json({ success: true, count: rows.length, data: rows });
    } catch (error) {
        console.error('GET /students error:', error);
        res.status(500).json({ success: false, error: 'Failed to fetch students' });
    }
});

// GET /api/students/:id - Get single student
app.get('/api/students/:id', async (req, res) => {
    try {
        const [rows] = await pool.execute('SELECT * FROM students WHERE id = ?', [req.params.id]);

        if (rows.length === 0) {
            return res.status(404).json({ success: false, error: 'Student not found' });
        }

        res.json({ success: true, data: rows[0] });
    } catch (error) {
        res.status(500).json({ success: false, error: 'Failed to fetch student' });
    }
});

// POST /api/students - Create student
app.post('/api/students', async (req, res) => {
    try {
        const { name, email, age, course } = req.body;

        // Validation
        if (!name || !email) {
            return res.status(400).json({ success: false, error: 'Name and email are required' });
        }

        const [result] = await pool.execute(
            'INSERT INTO students (name, email, age, course) VALUES (?, ?, ?, ?)',
            [name, email, age || null, course || null]
        );

        res.status(201).json({
            success: true,
            message: 'Student created',
            data: { id: result.insertId, name, email, age, course }
        });
    } catch (error) {
        if (error.code === 'ER_DUP_ENTRY') {
            return res.status(400).json({ success: false, error: 'Email already exists' });
        }
        res.status(500).json({ success: false, error: 'Failed to create student' });
    }
});

// PUT /api/students/:id - Update student
app.put('/api/students/:id', async (req, res) => {
    try {
        const { name, email, age, course } = req.body;
        const id = req.params.id;

        // Check if exists
        const [existing] = await pool.execute('SELECT * FROM students WHERE id = ?', [id]);
        if (existing.length === 0) {
            return res.status(404).json({ success: false, error: 'Student not found' });
        }

        const student = existing[0];
        const [result] = await pool.execute(
            'UPDATE students SET name = ?, email = ?, age = ?, course = ? WHERE id = ?',
            [
                name || student.name,
                email || student.email,
                age !== undefined ? age : student.age,
                course !== undefined ? course : student.course,
                id
            ]
        );

        res.json({ success: true, message: 'Student updated' });
    } catch (error) {
        if (error.code === 'ER_DUP_ENTRY') {
            return res.status(400).json({ success: false, error: 'Email already exists' });
        }
        res.status(500).json({ success: false, error: 'Failed to update student' });
    }
});

// DELETE /api/students/:id - Delete student
app.delete('/api/students/:id', async (req, res) => {
    try {
        const [result] = await pool.execute('DELETE FROM students WHERE id = ?', [req.params.id]);

        if (result.affectedRows === 0) {
            return res.status(404).json({ success: false, error: 'Student not found' });
        }

        res.json({ success: true, message: 'Student deleted' });
    } catch (error) {
        res.status(500).json({ success: false, error: 'Failed to delete student' });
    }
});

// Health check
app.get('/health', (req, res) => {
    res.json({ status: 'OK', timestamp: new Date().toISOString() });
});

// Start server
app.listen(PORT, () => {
    console.log(`Server running at http://localhost:${PORT}`);
});</code></pre>
    </div>

    <!-- Step 3: Frontend HTML -->
    <div class="file-section">
        <div class="file-header">
            <span class="step-number">5</span> frontend/index.html - User Interface
        </div>
        <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Student Manager&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;nav class="navbar navbar-dark bg-dark"&gt;
        &lt;div class="container"&gt;
            &lt;span class="navbar-brand"&gt;Student Manager&lt;/span&gt;
        &lt;/div&gt;
    &lt;/nav&gt;

    &lt;div class="container mt-4"&gt;
        &lt;!-- Alert for messages --&gt;
        &lt;div id="alertBox" class="alert d-none" role="alert"&gt;&lt;/div&gt;

        &lt;!-- Add Student Form --&gt;
        &lt;div class="card mb-4"&gt;
            &lt;div class="card-header bg-primary text-white"&gt;Add New Student&lt;/div&gt;
            &lt;div class="card-body"&gt;
                &lt;form id="studentForm"&gt;
                    &lt;div class="row g-3"&gt;
                        &lt;div class="col-md-3"&gt;
                            &lt;input type="text" id="name" class="form-control" placeholder="Name" required&gt;
                        &lt;/div&gt;
                        &lt;div class="col-md-3"&gt;
                            &lt;input type="email" id="email" class="form-control" placeholder="Email" required&gt;
                        &lt;/div&gt;
                        &lt;div class="col-md-2"&gt;
                            &lt;input type="number" id="age" class="form-control" placeholder="Age"&gt;
                        &lt;/div&gt;
                        &lt;div class="col-md-2"&gt;
                            &lt;input type="text" id="course" class="form-control" placeholder="Course"&gt;
                        &lt;/div&gt;
                        &lt;div class="col-md-2"&gt;
                            &lt;button type="submit" class="btn btn-primary w-100"&gt;Add&lt;/button&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/form&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;!-- Search --&gt;
        &lt;div class="input-group mb-3"&gt;
            &lt;input type="text" id="searchInput" class="form-control" placeholder="Search students..."&gt;
            &lt;button class="btn btn-outline-secondary" onclick="loadStudents()"&gt;Search&lt;/button&gt;
        &lt;/div&gt;

        &lt;!-- Student Table --&gt;
        &lt;div class="table-responsive"&gt;
            &lt;table class="table table-striped table-hover"&gt;
                &lt;thead class="table-dark"&gt;
                    &lt;tr&gt;
                        &lt;th&gt;ID&lt;/th&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Email&lt;/th&gt;
                        &lt;th&gt;Age&lt;/th&gt;&lt;th&gt;Course&lt;/th&gt;&lt;th&gt;Actions&lt;/th&gt;
                    &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody id="studentList"&gt;&lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;script src="app.js"&gt;&lt;/script&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
    </div>

    <!-- Step 4: Frontend JS -->
    <div class="file-section">
        <div class="file-header">
            <span class="step-number">6</span> frontend/app.js - Frontend Logic
        </div>
        <pre><code>// app.js - Frontend API integration
const API_URL = 'http://localhost:3000/api/students';

// Load on page ready
document.addEventListener('DOMContentLoaded', () => {
    loadStudents();
    document.getElementById('studentForm').addEventListener('submit', addStudent);
    document.getElementById('searchInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') loadStudents();
    });
});

// Show alert messages
function showAlert(message, type = 'success') {
    const alertBox = document.getElementById('alertBox');
    alertBox.className = `alert alert-${type}`;
    alertBox.textContent = message;
    alertBox.classList.remove('d-none');
    setTimeout(() => alertBox.classList.add('d-none'), 3000);
}

// GET - Load all students
async function loadStudents() {
    const tbody = document.getElementById('studentList');
    const search = document.getElementById('searchInput').value;

    tbody.innerHTML = '&lt;tr&gt;&lt;td colspan="6" class="text-center"&gt;Loading...&lt;/td&gt;&lt;/tr&gt;';

    try {
        let url = API_URL;
        if (search) url += `?search=${encodeURIComponent(search)}`;

        const response = await fetch(url);
        const result = await response.json();

        if (result.data.length === 0) {
            tbody.innerHTML = '&lt;tr&gt;&lt;td colspan="6" class="text-center text-muted"&gt;No students found&lt;/td&gt;&lt;/tr&gt;';
            return;
        }

        tbody.innerHTML = result.data.map(s => `
            &lt;tr&gt;
                &lt;td&gt;${s.id}&lt;/td&gt;
                &lt;td&gt;${escapeHtml(s.name)}&lt;/td&gt;
                &lt;td&gt;${escapeHtml(s.email)}&lt;/td&gt;
                &lt;td&gt;${s.age || '-'}&lt;/td&gt;
                &lt;td&gt;${escapeHtml(s.course || '-')}&lt;/td&gt;
                &lt;td&gt;
                    &lt;button class="btn btn-warning btn-sm" onclick="editStudent(${s.id})"&gt;Edit&lt;/button&gt;
                    &lt;button class="btn btn-danger btn-sm" onclick="deleteStudent(${s.id})"&gt;Delete&lt;/button&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        `).join('');
    } catch (error) {
        tbody.innerHTML = '&lt;tr&gt;&lt;td colspan="6" class="text-center text-danger"&gt;Error loading data&lt;/td&gt;&lt;/tr&gt;';
        showAlert('Failed to load students: ' + error.message, 'danger');
    }
}

// POST - Add new student
async function addStudent(e) {
    e.preventDefault();

    const data = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        age: document.getElementById('age').value || null,
        course: document.getElementById('course').value || null
    };

    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (!response.ok) {
            showAlert(result.error, 'danger');
            return;
        }

        showAlert('Student added successfully!');
        document.getElementById('studentForm').reset();
        loadStudents();
    } catch (error) {
        showAlert('Failed to add student', 'danger');
    }
}

// PUT - Edit student
async function editStudent(id) {
    const name = prompt('Enter new name:');
    if (!name) return;

    const email = prompt('Enter new email:');
    if (!email) return;

    try {
        const response = await fetch(`${API_URL}/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email })
        });

        const result = await response.json();

        if (!response.ok) {
            showAlert(result.error, 'danger');
            return;
        }

        showAlert('Student updated!');
        loadStudents();
    } catch (error) {
        showAlert('Failed to update student', 'danger');
    }
}

// DELETE - Remove student
async function deleteStudent(id) {
    if (!confirm('Are you sure you want to delete this student?')) return;

    try {
        const response = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
        const result = await response.json();

        if (!response.ok) {
            showAlert(result.error, 'danger');
            return;
        }

        showAlert('Student deleted');
        loadStudents();
    } catch (error) {
        showAlert('Failed to delete student', 'danger');
    }
}

// Prevent XSS
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}</code></pre>
    </div>

    <div class="note">
        <h3>Running the Application</h3>
        <ol>
            <li>Run the SQL setup script in MySQL</li>
            <li>Navigate to <span class="inline-code">backend/</span> and run <span class="inline-code">npm install</span></li>
            <li>Create <span class="inline-code">.env</span> with your database credentials</li>
            <li>Start backend: <span class="inline-code">npm start</span> (runs on port 3000)</li>
            <li>Open <span class="inline-code">frontend/index.html</span> with Live Server (port 5500)</li>
            <li>The frontend will fetch data from the backend API</li>
        </ol>
    </div>

    <h2>Summary</h2>
    <ul>
        <li><strong>Backend:</strong> Express + MySQL handles data storage and API endpoints</li>
        <li><strong>Frontend:</strong> Bootstrap for UI + Fetch API for HTTP requests</li>
        <li><strong>CORS:</strong> Enabled to allow frontend-backend communication</li>
        <li><strong>Security:</strong> Prepared statements prevent SQL injection, HTML escaping prevents XSS</li>
        <li><strong>UX:</strong> Loading states, error messages, and search functionality</li>
    </ul>

    <hr>
    <p><a href="index.html">&larr; Back to Examples</a></p>
</body>
</html>
