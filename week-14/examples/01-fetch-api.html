<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch API Demo - Week 14 Example</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        .method-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }
        .get { background: #4caf50; }
        .post { background: #2196f3; }
        .put { background: #ff9800; }
        .delete { background: #f44336; }
        .output {
            background: #1a1a2e;
            color: #e0e0e0;
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .accent { color: #607d8b; }
    </style>
</head>
<body>
    <div class="container py-4">
        <p><a href="index.html">&larr; Back to Examples</a></p>

        <h1 class="accent mb-4">Fetch API - Interactive Demo</h1>
        <p class="lead">Using <a href="https://jsonplaceholder.typicode.com/" target="_blank">JSONPlaceholder</a> - a free fake REST API for testing.</p>

        <!-- GET Request -->
        <div class="card mb-4">
            <div class="card-header">
                <span class="method-badge get">GET</span>
                <strong class="ms-2">Fetch Users</strong>
            </div>
            <div class="card-body">
                <p>Fetches a list of users from the API.</p>
                <button class="btn btn-success" onclick="fetchUsers()">Fetch Users</button>
                <button class="btn btn-outline-secondary ms-2" onclick="clearOutput('getOutput')">Clear</button>
                <div class="output mt-3" id="getOutput">Click "Fetch Users" to see the result...</div>

                <div class="mt-3">
                    <h6>Code:</h6>
                    <pre class="bg-dark text-light p-3 rounded"><code>async function fetchUsers() {
    const response = await fetch('https://jsonplaceholder.typicode.com/users');
    const users = await response.json();
    console.log(users);
}</code></pre>
                </div>
            </div>
        </div>

        <!-- GET Single -->
        <div class="card mb-4">
            <div class="card-header">
                <span class="method-badge get">GET</span>
                <strong class="ms-2">Fetch Single Post</strong>
            </div>
            <div class="card-body">
                <div class="input-group mb-3" style="max-width: 400px;">
                    <span class="input-group-text">Post ID:</span>
                    <input type="number" id="postId" class="form-control" value="1" min="1" max="100">
                    <button class="btn btn-success" onclick="fetchPost()">Fetch</button>
                </div>
                <div class="output mt-3" id="getOneOutput">Enter a post ID (1-100) and click "Fetch"...</div>
            </div>
        </div>

        <!-- POST Request -->
        <div class="card mb-4">
            <div class="card-header">
                <span class="method-badge post">POST</span>
                <strong class="ms-2">Create New Post</strong>
            </div>
            <div class="card-body">
                <form id="createForm" onsubmit="createPost(event)">
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Title</label>
                            <input type="text" id="postTitle" class="form-control" value="My New Post" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Body</label>
                            <input type="text" id="postBody" class="form-control" value="This is the content of my post" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Post</button>
                </form>
                <div class="output mt-3" id="postOutput">Fill the form and click "Create Post"...</div>

                <div class="mt-3">
                    <h6>Code:</h6>
                    <pre class="bg-dark text-light p-3 rounded"><code>async function createPost(title, body) {
    const response = await fetch('https://jsonplaceholder.typicode.com/posts', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, body, userId: 1 })
    });
    const result = await response.json();
    console.log('Created:', result);
}</code></pre>
                </div>
            </div>
        </div>

        <!-- PUT Request -->
        <div class="card mb-4">
            <div class="card-header">
                <span class="method-badge put">PUT</span>
                <strong class="ms-2">Update Post</strong>
            </div>
            <div class="card-body">
                <form onsubmit="updatePost(event)">
                    <div class="row g-3 mb-3">
                        <div class="col-md-3">
                            <label class="form-label">Post ID</label>
                            <input type="number" id="updateId" class="form-control" value="1">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">New Title</label>
                            <input type="text" id="updateTitle" class="form-control" value="Updated Title">
                        </div>
                        <div class="col-md-5">
                            <label class="form-label">New Body</label>
                            <input type="text" id="updateBody" class="form-control" value="Updated body content">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-warning">Update Post</button>
                </form>
                <div class="output mt-3" id="putOutput">Fill the form and click "Update Post"...</div>
            </div>
        </div>

        <!-- DELETE Request -->
        <div class="card mb-4">
            <div class="card-header">
                <span class="method-badge delete">DELETE</span>
                <strong class="ms-2">Delete Post</strong>
            </div>
            <div class="card-body">
                <div class="input-group mb-3" style="max-width: 400px;">
                    <span class="input-group-text">Post ID to delete:</span>
                    <input type="number" id="deleteId" class="form-control" value="1">
                    <button class="btn btn-danger" onclick="deletePost()">Delete</button>
                </div>
                <div class="output mt-3" id="deleteOutput">Enter a post ID and click "Delete"...</div>
            </div>
        </div>

        <!-- Error Handling -->
        <div class="card mb-4">
            <div class="card-header bg-warning">
                <strong>Error Handling Demo</strong>
            </div>
            <div class="card-body">
                <p>Try fetching from invalid endpoints to see error handling:</p>
                <button class="btn btn-outline-danger" onclick="fetchInvalid()">Fetch Invalid URL</button>
                <button class="btn btn-outline-danger ms-2" onclick="fetch404()">Fetch 404</button>
                <div class="output mt-3" id="errorOutput">Click a button to see error handling in action...</div>
            </div>
        </div>

        <hr>
        <p><a href="index.html">&larr; Back to Examples</a></p>
    </div>

    <script>
        const BASE_URL = 'https://jsonplaceholder.typicode.com';

        function formatOutput(data) {
            return JSON.stringify(data, null, 2);
        }

        function clearOutput(id) {
            document.getElementById(id).textContent = 'Cleared.';
        }

        // GET - Fetch users
        async function fetchUsers() {
            const output = document.getElementById('getOutput');
            output.textContent = 'Loading...';

            try {
                const response = await fetch(`${BASE_URL}/users`);
                const users = await response.json();

                output.textContent = `Status: ${response.status} ${response.statusText}\n\n`;
                output.textContent += `Found ${users.length} users:\n\n`;
                users.forEach(user => {
                    output.textContent += `  ${user.id}. ${user.name} (${user.email})\n`;
                });
                output.textContent += `\nFull JSON:\n${formatOutput(users.slice(0, 3))}`;
                output.textContent += `\n... (showing first 3 of ${users.length})`;
            } catch (error) {
                output.textContent = `Error: ${error.message}`;
            }
        }

        // GET - Fetch single post
        async function fetchPost() {
            const id = document.getElementById('postId').value;
            const output = document.getElementById('getOneOutput');
            output.textContent = 'Loading...';

            try {
                const response = await fetch(`${BASE_URL}/posts/${id}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const post = await response.json();

                output.textContent = `Status: ${response.status}\n\n`;
                output.textContent += formatOutput(post);
            } catch (error) {
                output.textContent = `Error: ${error.message}`;
            }
        }

        // POST - Create post
        async function createPost(e) {
            e.preventDefault();
            const output = document.getElementById('postOutput');
            output.textContent = 'Creating...';

            const postData = {
                title: document.getElementById('postTitle').value,
                body: document.getElementById('postBody').value,
                userId: 1
            };

            try {
                const response = await fetch(`${BASE_URL}/posts`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData)
                });

                const result = await response.json();

                output.textContent = `Status: ${response.status} (Created!)\n\n`;
                output.textContent += `Request Body:\n${formatOutput(postData)}\n\n`;
                output.textContent += `Response:\n${formatOutput(result)}`;
            } catch (error) {
                output.textContent = `Error: ${error.message}`;
            }
        }

        // PUT - Update post
        async function updatePost(e) {
            e.preventDefault();
            const output = document.getElementById('putOutput');
            output.textContent = 'Updating...';

            const updateData = {
                id: parseInt(document.getElementById('updateId').value),
                title: document.getElementById('updateTitle').value,
                body: document.getElementById('updateBody').value,
                userId: 1
            };

            try {
                const response = await fetch(`${BASE_URL}/posts/${updateData.id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updateData)
                });

                const result = await response.json();

                output.textContent = `Status: ${response.status} (Updated!)\n\n`;
                output.textContent += `Response:\n${formatOutput(result)}`;
            } catch (error) {
                output.textContent = `Error: ${error.message}`;
            }
        }

        // DELETE - Delete post
        async function deletePost() {
            const id = document.getElementById('deleteId').value;
            const output = document.getElementById('deleteOutput');
            output.textContent = 'Deleting...';

            try {
                const response = await fetch(`${BASE_URL}/posts/${id}`, {
                    method: 'DELETE'
                });

                output.textContent = `Status: ${response.status}\n\n`;
                output.textContent += `Post #${id} deleted successfully!`;
                output.textContent += `\n\nNote: JSONPlaceholder simulates deletion but doesn't actually delete.`;
            } catch (error) {
                output.textContent = `Error: ${error.message}`;
            }
        }

        // Error handling demos
        async function fetchInvalid() {
            const output = document.getElementById('errorOutput');
            output.textContent = 'Attempting to fetch invalid URL...';

            try {
                const response = await fetch('https://invalid-url-that-does-not-exist.com/api');
                const data = await response.json();
                output.textContent = formatOutput(data);
            } catch (error) {
                output.textContent = `Network Error Caught!\n\n`;
                output.textContent += `Error Type: ${error.constructor.name}\n`;
                output.textContent += `Message: ${error.message}\n\n`;
                output.textContent += `This is a network error - the server doesn't exist.\n`;
                output.textContent += `Always wrap fetch calls in try/catch to handle these!`;
            }
        }

        async function fetch404() {
            const output = document.getElementById('errorOutput');
            output.textContent = 'Attempting to fetch non-existent resource...';

            try {
                const response = await fetch(`${BASE_URL}/posts/99999`);

                output.textContent = `HTTP Status: ${response.status}\n`;
                output.textContent += `OK: ${response.ok}\n\n`;

                if (!response.ok) {
                    output.textContent += `Important: fetch() doesn't throw on HTTP errors!\n`;
                    output.textContent += `You need to check response.ok or response.status.\n\n`;
                    output.textContent += `The response body: ${await response.text() || '(empty)'}`;
                }
            } catch (error) {
                output.textContent = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
